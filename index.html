<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Ki·ªÉm tra & ƒê√°nh gi√° | OSS PHP</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 420px;
            text-align: center;
        }

        h2 {
            color: #2d3436;
            margin: 10px 0;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-sizing: border-box;
            outline: none;
        }

        /* Progress Bar */
        .progress-area {
            display: none;
            margin: 20px 0;
        }

        .progress-bg {
            width: 100%;
            background: #eee;
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            background: var(--primary);
            transition: width 0.4s;
        }

        #statusLabel {
            font-size: 13px;
            color: #636e72;
            margin-bottom: 5px;
            font-style: italic;
        }

        /* Badge */
        .badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            margin-left: 5px;
        }

        .excellent {
            background: #dff9fb;
            color: var(--success);
        }

        .good {
            background: #fef9e7;
            color: var(--warning);
        }

        .slow {
            background: #fdedec;
            color: var(--danger);
        }

        /* Result & Rating */
        #serverResult,
        #ratingSection,
        #finalCard {
            display: none;
            animation: fadeIn 0.5s;
        }

        .info-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            text-align: left;
            margin: 15px 0;
            border-left: 4px solid var(--primary);
        }

        .rating {
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
            margin: 15px 0;
        }

        .rating input {
            display: none;
        }

        .rating label {
            cursor: pointer;
            font-size: 35px;
            color: #ddd;
            transition: 0.2s;
        }

        .rating label:before {
            content: '‚òÖ';
        }

        .rating input:checked~label,
        .rating label:hover,
        .rating label:hover~label {
            color: var(--warning);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
            margin-top: 10px;
        }

        .btn-check {
            background: var(--primary);
            color: white;
        }

        .btn-rate {
            background: var(--success);
            color: white;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="card">
        <div id="step1">
            <i class="fas fa-server" style="font-size: 40px; color: var(--primary);"></i>
            <h2>B∆∞·ªõc 1: Ki·ªÉm tra</h2>
            <input type="text" id="userName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n...">
            <input type="date" id="userDob">
            <button class="btn btn-check" onclick="startCheck()" id="btnCheck">Ki·ªÉm tra k·∫øt n·ªëi</button>
        </div>

        <div class="progress-area" id="progArea">
            <div id="statusLabel">Kh·ªüi t·∫°o...</div>
            <div class="progress-bg">
                <div class="progress-fill" id="progFill"></div>
            </div>
        </div>

        <div id="serverResult" class="info-box">
            <div id="resTime">üïí Gi·ªù: --</div>
            <div id="resCount">üî¢ T·ªïng l∆∞·ª£t: --</div>
            <div id="resLatency">‚ö° Ph·∫£n h·ªìi: -- <span id="resBadge"></span></div>
        </div>

        <div id="ratingSection">
            <hr style="border: 0; border-top: 1px dashed #ddd; margin: 20px 0;">
            <h2>B∆∞·ªõc 2: ƒê√°nh gi√°</h2>
            <div class="rating">
                <input type="radio" name="star" id="s5" value="5"><label for="s5"></label>
                <input type="radio" name="star" id="s4" value="4"><label for="s4"></label>
                <input type="radio" name="star" id="s3" value="3"><label for="s3"></label>
                <input type="radio" name="star" id="s2" value="2"><label for="s2"></label>
                <input type="radio" name="star" id="s1" value="1"><label for="s1"></label>
            </div>
            <button class="btn btn-rate" onclick="submitRating()">G·ª≠i ƒë√°nh gi√°</button>
        </div>

        <div id="finalCard" style="background: #e8f8f5; padding: 20px; border-radius: 15px;">
            <i class="fas fa-check-circle" style="font-size: 50px; color: var(--success);"></i>
            <h3 style="color: var(--success);">Th√†nh c√¥ng!</h3>
            <p>C·∫£m ∆°n <strong id="fName"></strong> ƒë√£ ch·∫•m <span id="fStar" style="color:var(--warning)"></span> sao.
            </p>
            <button onclick="location.reload()" class="btn" style="background:white; border:1px solid #ddd;">L√†m
                m·ªõi</button>
        </div>
    </div>

    <script>
        // C·∫¨P NH·∫¨T LINK API CHO PHP (http)
        const API = 'http://dh52201267oss.somee.com/time.php';

        async function startCheck() {
            const name = document.getElementById('userName').value;
            if (!name) return alert("Vui l√≤ng nh·∫≠p t√™n!");

            document.getElementById('btnCheck').style.display = 'none';
            document.getElementById('progArea').style.display = 'block';

            const steps = [
                { p: 30, t: "ƒêang qu√©t ƒë·ªãa ch·ªâ IP..." },
                { p: 60, t: "ƒêang k·∫øt n·ªëi Somee Server..." },
                { p: 90, t: "ƒêang truy v·∫•n Database..." }
            ];

            for (let s of steps) {
                document.getElementById('statusLabel').innerText = s.t;
                document.getElementById('progFill').style.width = s.p + "%";
                await new Promise(r => setTimeout(r, 700));
            }

            try {
                const start = performance.now();
                // Fetch t·ªõi file PHP
                const res = await fetch(API, { method: 'GET' });
                const data = await res.json();
                const ms = Math.round(performance.now() - start);

                document.getElementById('progFill').style.width = "100%";
                document.getElementById('statusLabel').innerText = "Ho√†n t·∫•t!";

                document.getElementById('resTime').innerText = "üïí Gi·ªù: " + data.serverTime;
                document.getElementById('resCount').innerText = "üî¢ T·ªïng l∆∞·ª£t: " + data.totalChecks;
                document.getElementById('resLatency').innerText = "‚ö° Ph·∫£n h·ªìi: " + ms + " ms";

                const b = document.getElementById('resBadge');
                if (ms < 200) { b.innerText = "TUY·ªÜT V·ªúI"; b.className = "badge excellent"; }
                else if (ms < 800) { b.innerText = "·ªîN ƒê·ªäNH"; b.className = "badge good"; }
                else { b.innerText = "CH·∫¨M"; b.className = "badge slow"; }

                document.getElementById('progArea').style.display = 'none';
                document.getElementById('serverResult').style.display = 'block';
                document.getElementById('ratingSection').style.display = 'block';
            } catch (e) {
                alert("L·ªói k·∫øt n·ªëi! H√£y ch·∫Øc ch·∫Øn b·∫°n truy c·∫≠p b·∫±ng 'http' (kh√¥ng s).");
                location.reload();
            }
        }

        async function submitRating() {
            const star = document.querySelector('input[name="star"]:checked');
            if (!star) return alert("Vui l√≤ng ch·ªçn s·ªë sao!");

            try {
                // Fetch POST t·ªõi file PHP
                const res = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('userName').value,
                        dob: document.getElementById('userDob').value || "",
                        rating: parseInt(star.value)
                    })
                });
                const result = await res.json();

                // Ki·ªÉm tra k·∫øt qu·∫£ tr·∫£ v·ªÅ t·ª´ PHP
                if (result.success) {
                    document.getElementById('serverResult').style.display = 'none';
                    document.getElementById('ratingSection').style.display = 'none';
                    document.getElementById('step1').style.display = 'none';
                    document.getElementById('finalCard').style.display = 'block';
                    document.getElementById('fName').innerText = result.data.name;
                    document.getElementById('fStar').innerText = result.data.rating;
                } else {
                    alert("L·ªói server: " + (result.message || "Kh√¥ng r√µ"));
                }
            } catch (e) { alert("L·ªói khi g·ª≠i!"); }
        }
    </script>
</body>

</html>